<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="log">

	<resultMap id="logMap" class="java.util.HashMap">
		<result property="Seq" column="log_seq" javaType="String"/>
		<result property="class" column="class_name" javaType="String"/>
		<result property="stat" column="status" javaType="String"/>
	</resultMap>
	
	<select id="log.selectStartLog" resultMap="logMap">
		SELECT LOG_SEQ,
		       CLASS_NAME,
		       STATUS
		FROM   MSR_DAEMON_LOG
		WHERE  LOG_SEQ = (SELECT MAX(LOG_SEQ)
		        FROM   MSR_DAEMON_LOG WHERE SCRIPT_NAME = #script_name#)		
	</select>

	<insert id="log.insertStartLog" parameterClass="java.util.Map">
		INSERT INTO MSR_DAEMON_LOG (LOG_SEQ, SCRIPT_NAME, CLASS_NAME, STATUS, START_DATE, LOG_DESC)
		VALUES (seq_msr_daemon_log.nextval, #sh#, #name#, #status#, sysdate, #desc#)	
	</insert>
	
	<insert id="log.insertErrorLog" parameterClass="java.util.Map">
		INSERT INTO MSR_DAEMON_LOG (LOG_SEQ, SCRIPT_NAME, CLASS_NAME, STATUS, ERROR_DATE, LOG_DESC)
		VALUES (seq_msr_daemon_log.nextval, #sh#, #name#, #status#, sysdate, #desc#)
	</insert>
	
	<insert id="log.insertEndLog" parameterClass="java.util.Map">
		INSERT INTO MSR_DAEMON_LOG (LOG_SEQ, SCRIPT_NAME, CLASS_NAME, STATUS, END_DATE, LOG_DESC)
		VALUES (seq_msr_daemon_log.nextval, #sh#, #name#, #status#, sysdate, #desc#)
	</insert>
	
	<update id="log.updateLog" parameterClass="java.util.Map">
		UPDATE MSR_DAEMON_LOG
		SET    STATUS = #status# ,
		       END_DATE = SYSDATE ,
		       LOG_DESC =#log_desc#
		WHERE  LOG_SEQ = #seq#
	    AND	   SCRIPT_NAME = #sh_name#
	</update>
</sqlMap>
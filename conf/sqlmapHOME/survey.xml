<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="survey">
	<!-- 개인화 인박스 -->
	<insert id="survey.insertUserInBoxMsg" parameterClass="co.kr.istarbucks.xo.batch.common.dto.home.UserInboxDto">
		Insert into STB_USER_INBOX
	   			  (SUI_INDEX, SUI_WEB_YN, SUI_APP_YN, SUI_USER_ID, SUI_TITLE, 
	   			<isNotEmpty property="sui_url">
	   			   SUI_URL,
	   			</isNotEmpty>
	   			<isNotEmpty property="sui_date">
	   			   SUI_DATE,
	   			</isNotEmpty>
	   			<isNotEmpty property="sui_del_flag">
	   			   SUI_DEL_FLAG,
	   			</isNotEmpty>
	   			<isNotEmpty property="sui_visit">
	   			   SUI_VISIT,
	   			</isNotEmpty>
	   			<isNotEmpty property="sui_del_date">
	   			   SUI_DEL_DATE,
	   			</isNotEmpty>
	   			   SUI_LINK_YN
	   			   )
		 	  Values
		   		  ( STB_USER_INBOX_SEQ.nextval, #sui_web_yn#, #sui_app_yn#, #sui_user_id#, #sui_title#,
		   		<isNotEmpty property="sui_url">
		   		   #sui_url#,
		   		</isNotEmpty>
		   		<isNotEmpty property="sui_date">
		   		   #sui_date#,
		   		</isNotEmpty>
		   		<isNotEmpty property="sui_del_flag">
		   		   #sui_del_flag#,
		   		</isNotEmpty>
		   		<isNotEmpty property="sui_visit">
		   		   #sui_visit#,
		   		</isNotEmpty> 
		   		<isNotEmpty property="sui_del_date">
		   		   #sui_del_date#,
		   		</isNotEmpty>
		   		   #sui_link_yn#
		   		  )   			   
	</insert>
	
	<select id="survey.getSurveyJoinInfo" parameterClass="java.util.Map" resultClass="co.kr.istarbucks.xo.batch.common.dto.home.SurveyDto">		
		SELECT sm.USER_ID
			 , sm.BIRTH_YEAR
		     , sm.GENDER
		     , scj.SCS_IDX
		     , scj.SCJ_IDX
		     , scj.SCJ_STATUS
		     , (CASE WHEN scj.SCJ_STATUS IS NULL AND scj.SCJ_IDX IS NULL THEN 'Y'
		             ELSE 'N'
		        END) AS SURVEY_YN
		  FROM STB_MEMBER## sm
		     , STB_CV_JOIN scj
		 WHERE sm.USER_ID        = #user_id#
		   AND sm.USER_ID        = scj.SM_USER_ID(+)
		   AND scj.SCS_IDX(+)    = TO_NUMBER(#scs_idx#)
		   AND scj.SCJ_STATUS(+) = 'C'
	</select>
		
</sqlMap>
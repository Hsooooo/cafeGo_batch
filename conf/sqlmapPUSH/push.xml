<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="push">

	<!-- 대용량 발송을 위한 저장소 등록 -->
	<insert id="push.insertTblReservationPush" parameterClass="co.kr.istarbucks.xo.batch.common.dto.push.ReservationPushDto">
		INSERT /* [push.xml][push.insertTblReservationPush] */
		  INTO TBL_RESERVATION_PUSH (
		       device_id
		       , msg
		       , reg_date
		       , event_type
		       , device_type
		       , event_url
		       , topic_id
		       , screen_id
		       , param
		       , topic_yn
		       )
		VALUES (
		       #device_id#
		       , #msg#
		       , NOW()
		       , #event_type#
		       , #device_type#
		       , #event_url#
		       , #topic_id#
		       , #screen_id#
		       , #param#
		       , #topic_yn#
		       )
		<selectKey keyProperty="push_id" resultClass="int">
        	SELECT LAST_INSERT_ID()
		</selectKey>		       
	</insert>
	
    <!-- PUSH 솔루션 DB 테이블 TMS_PERSON_QUEUE(개인화 대용량 : TPQ)에 데이터 저장 -->
    <insert id="push.insertTmsPersonQueue" parameterClass="java.util.Map">
    	INSERT INTO TMS_PERSON_QUEUE
		(
            ch_gubun
          , msg_tp_cd
          , req_uid
          <isNotEmpty property="priorityFlag">
          , priority_flag
          </isNotEmpty>
          , to_id
          , content          
          , app_grp_id
          <isNotEmpty property="puInApp">          
          , pu_in_app
          </isNotEmpty>
          <isNotEmpty property="pushValue">
          , push_value
          </isNotEmpty>
          <isNotEmpty property="imgUrl">
          , img_url
          </isNotEmpty>
          , target_flag
          , reserv_date
          , reg_date
          <isNotEmpty property="pushType">
          , push_type
          </isNotEmpty>
		) VALUES (
			#chGubun# 
		  , #msgTpCd#
	      , #reqUid#
	      <isNotEmpty property="priorityFlag">	      
	      , #priorityFlag#
	      </isNotEmpty>
		  , #toId#
		  , #content#
		  , #appGrpId#
		  <isNotEmpty property="puInApp">		   	
		  , #puInApp#
		  </isNotEmpty>
		  <isNotEmpty property="pushValue">		  
		  , #pushValue#
		  </isNotEmpty>
		  <isNotEmpty property="imgUrl">		  
		  , #imgUrl#
		  </isNotEmpty>
		  , 'N'
		  , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		  , NOW()
		  <isNotEmpty property="pushType">
          , #pushType#
          </isNotEmpty>
		)
    </insert>
    
    
    <!-- PUSH 솔루션 DB 테이블 TMS_QUEUE에 데이터 저장 -->
    <insert id="push.insertTmsQueue" parameterClass="java.util.Map">
    	INSERT INTO TMS_QUEUE
		(
            ch_gubun
          , msg_tp_cd
          , req_uid
          <isNotEmpty property="priorityFlag">
          , priority_flag
          </isNotEmpty>
          , to_id
          , content          
          , app_grp_id
          <isNotEmpty property="puInApp">          
          , pu_in_app
          </isNotEmpty>
          <isNotEmpty property="pushValue">
          , push_value
          </isNotEmpty>
          <isNotEmpty property="imgUrl">
          , img_url
          </isNotEmpty>
          , target_flag
          , reserv_date
          , reg_date
          <isNotEmpty property="pushType">
          , push_type
          </isNotEmpty>
		) VALUES (
			#chGubun# 
		  , #msgTpCd#
	      , #reqUid#
	      <isNotEmpty property="priorityFlag">	      
	      , #priorityFlag#
	      </isNotEmpty>
		  , #toId#
		  , #content#
		  , #appGrpId#
		  <isNotEmpty property="puInApp">		   	
		  , #puInApp#
		  </isNotEmpty>
		  <isNotEmpty property="pushValue">		  
		  , #pushValue#
		  </isNotEmpty>
		  <isNotEmpty property="imgUrl">		  
		  , #imgUrl#
		  </isNotEmpty>
		  , 'N'
		  , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		  , NOW()
		  <isNotEmpty property="pushType">
          , #pushType#
          </isNotEmpty>
		)
    </insert>
</sqlMap>